"use strict";var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},_createClass=function(){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var getRect=function(t){return t.getBoundingClientRect()},getMousePos=function(t){var e={};return t&&void 0!==t.target&&(e.x=t&&t.clientX||t.touches&&t.touches[0].clientX,e.y=t&&t.clientY||t.touches&&t.touches[0].clientY),e},getFocusable=function(e,t){var i=e,s=void 0,n=0;do{if(i==document.body)break;s=[].concat(_toConsumableArray(i.parentNode.querySelectorAll('a[href], button, input, textarea, select, details, [tabindex]:not([tabindex="-1"])'))).filter(function(t){return!t.hasAttribute("disabled")&&!t.getAttribute("aria-hidden")}),"after"===t&&s.reverse(),n=s.findIndex(function(t){return e.contains(t)}),i=i.parentNode}while(0===n);return s.slice(0,n)[n-1]},triggerFocus=function(t){var e="onfocusin"in t?"focusin":"focus",i="onfocusin"in t,s=void 0;"createEvent"in document?(s=document.createEvent("Event")).initEvent(e,i,!0):"Event"in window&&(s=new Event(e,{bubbles:i,cancelable:!0})),t.focus(),t.dispatchEvent(s)},inOutQuad=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},JsSlide=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:".slide-cont",e=arguments[1];_classCallCheck(this,i),this.option=_extends({type:"carousel",infinite:!1,drag:!1,reactDrag:!1,timer:!1,timerSpeed:2e3,duration:500,start:1,show:1,between:0},e),this.$wrap=document.querySelector(t),this.$el={slideWrap:this.$wrap.querySelector(".slide-wrap"),slide:this.$wrap.querySelector(".slide"),slideItem:this.$wrap.querySelectorAll(".slide li"),slideItemDub:null,btnPrev:this.$wrap.querySelector(".btn-prev"),btnNext:this.$wrap.querySelector(".btn-next"),indicator:this.$wrap.querySelector(".indicator"),indicatorItem:null,btnTimer:this.$wrap.querySelector(".btn-timer")},this.$etc={before:getFocusable(this.$wrap,"before")||document.createElement("div"),after:getFocusable(this.$wrap,"after")||document.createElement("div"),focusItem:[]},this.slideNow=0,this.slidePrev=0,this.slideNext=0,this.slideNum=this.$el.slideItem.length,this.slideActive=0,this.slideFocus=0,this.rectSlide={},this.itemWidth=0,this.start={},this.move={},this.deltaX=0,this.deltaY=0,this.drag=0,this.timer=null,this.timerResize=null,this.direction=null,this.isAnimating=!1,this.isBlockPrev=!1,this.isBlockNext=!1,this.clicked=!1,this.isFocusing=!1,this.initSlide(),this.setSlide(),this.setTimer(),this.bindEvent(),this.showSlide(this.option.start)}return _createClass(i,[{key:"initSlide",value:function(){var t,e,s=this;[].concat(_toConsumableArray(this.$el.slideItem)).forEach(function(t,e){t.slideIndex=e,t.querySelector("img")&&t.querySelector("img").setAttribute("draggable",!1),s.$el.indicator.innerHTML+='<li><button type="button"><span class="screen-out">총 '+s.slideNum+"장의 슬라이드 중 "+(e+1)+"번째 슬라이드</span></button></li>"}),this.option.infinite&&"carousel"==this.option.type?(t=[].concat(_toConsumableArray(this.$el.slideItem)).filter(function(t,e){return e<s.option.show}),e=[].concat(_toConsumableArray(this.$el.slideItem)).reverse().filter(function(t,e){return e<s.option.show}),t.forEach(function(t,e){s.$el.slide.appendChild(t.cloneNode(!0)).slideIndex=e}),e.forEach(function(t,e){s.$el.slide.insertBefore(t.cloneNode(!0),s.$el.slide.firstChild).slideIndex=s.slideNum-(e+1)})):this.option.infinite||"carousel"!=this.option.type||[].concat(_toConsumableArray(this.$wrap.querySelectorAll(".indicator li"))).forEach(function(t,e,i){e>s.slideNum-s.option.show&&i[e].remove()}),this.$el.indicatorItem=this.$wrap.querySelectorAll(".indicator li"),this.$el.slideItemDub=this.$wrap.querySelectorAll(".slide li")}},{key:"setSlide",value:function(){var i=this;this.option.reactDrag="fade"!=this.option.type&&this.option.reactDrag,this.option.show="fade"==this.option.type?1:this.option.show,this.rectSlide=getRect(this.$el.slideWrap),this.itemWidth=this.rectSlide.width/this.option.show;var s=(this.$el.slideItemDub.length-this.slideNum)/2;[].concat(_toConsumableArray(this.$el.slideItemDub)).forEach(function(t,e){"carousel"==i.option.type&&(t.style.width=i.itemWidth+"px",t.style.left=(i.itemWidth+i.option.between)*e-(i.itemWidth+i.option.between)*s+"px"),i.$etc.focusItem[e]=[].concat(_toConsumableArray(t.querySelectorAll('a[href], button, input, textarea, select, details, [tabindex]:not([tabindex="-1"])'))),i.$etc.focusItem[e].length<=0&&(i.$etc.focusItem[e]=[t],t.setAttribute("tabindex",0))})}},{key:"bindEvent",value:function(){var i=this;this.$el.btnPrev.addEventListener("click",function(){i.direction="prev",i.showSlide(i.slidePrev)}),this.$el.btnNext.addEventListener("click",function(){i.direction="next",i.showSlide(i.slideNext)}),[].concat(_toConsumableArray(this.$el.indicatorItem)).forEach(function(t,e){t.addEventListener("click",function(){i.direction=null,i.showSlide(e+1)})}),this.$el.btnTimer.addEventListener("click",function(){i.option.timer=!i.option.timer,i.setTimer()}),window.addEventListener("resize",function(){return i.resize()}),["mousedown","touchstart"].forEach(function(t){i.$el.slide.addEventListener(t,function(t){return i.mouseDown(t)})}),["mousemove","touchmove"].forEach(function(t){document.addEventListener(t,function(t){return i.mouseMove(t)},{passive:!1})}),["mouseup","touchend"].forEach(function(t){document.addEventListener(t,function(){return i.mouseUp()})}),[].concat(_toConsumableArray(this.$el.slideItemDub),_toConsumableArray(this.$el.indicatorItem),[this.$el.btnPrev,this.$el.btnNext,this.$el.btnTimer,this.$etc.after,this.$etc.before]).forEach(function(t){t.addEventListener("keydown",function(t){i.keyDown(t)})})}},{key:"showSlide",value:function(t){return!this.isAnimating&&(this.isBlockNext&&(this.option.timer=!1,this.setTimer()),(this.isBlockPrev&&"prev"==this.direction||this.isBlockNext&&"next"==this.direction)&&(t=this.slideNow),this.stopTimer(),this.option.timer&&this.playTimer(),"carousel"==this.option.type?(this.slideActive=this.option.infinite?t-1+this.option.show:t-1,this.moveCarousel(t)):"fade"==this.option.type&&(this.slideActive=t-1,this.moveFade(t)),this.setIndex(t),this.setIndicator(),this.setAccessibility(),!this.option.infinite&&void this.setSlideBlock())}},{key:"moveFade",value:function(i){var s=this;[].concat(_toConsumableArray(this.$el.slideItem)).forEach(function(t){t.style.opacity=0});function n(t){r||(r=t,s.animationStart());var e=t-r,t=e/s.option.duration,t=inOutQuad(Math.min(t,1));s.$el.slideItem[o-1].style.opacity=1-t,s.$el.slideItem[i-1].style.opacity=t,e<s.option.duration?l=window.requestAnimationFrame(n):s.animationEnd()}var o=this.slideNow,r=null,l=null,l=window.requestAnimationFrame(n);0!==this.slideNow&&i!=this.slideNow||(this.$el.slideItem[i-1].style.opacity=1,cancelAnimationFrame(l))}},{key:"moveCarousel",value:function(t){var i=this,s=this.slideNow,n=this.drag,o=s-t,r=null,l=null;this.option.infinite&&s==this.slideNum&&"next"==this.direction?(o=-1,this.slideActive+=this.slideNum):this.option.infinite&&1==s&&"prev"==this.direction&&(o=1,this.slideActive-=this.slideNum);function a(t){r||(r=t,i.animationStart());var e=t-r,t=e/i.option.duration,t=inOutQuad(Math.min(t,1));i.$el.slide.style.transform="translate3d("+(-(i.itemWidth+i.option.between)*(s-1)+n+o*(i.itemWidth+i.option.between)*t-n*t)+"px, 0, 0)",e<i.option.duration?l=window.requestAnimationFrame(a):i.animationEnd()}l=window.requestAnimationFrame(a);0===this.slideNow&&(this.$el.slide.style.transform="translate3d("+-(t-1)*this.itemWidth+"px, 0, 0)",cancelAnimationFrame(l))}},{key:"animationStart",value:function(){this.isAnimating=!0}},{key:"animationEnd",value:function(){if(this.isAnimating=!1,!this.isFocusing)return!1;this.option.timer=!1,this.setTimer(),triggerFocus(this.$etc.focusItem[this.slideActive][0])}},{key:"setIndex",value:function(t){this.slideNow=t,this.slidePrev=t-1<1?this.slideNum:t-1,this.slideNext=t+1>this.slideNum?1:t+1}},{key:"setIndicator",value:function(){var i=this;[].concat(_toConsumableArray(this.$el.indicatorItem)).forEach(function(t,e){e===i.slideNow-1?(t.classList.add("active"),t.setAttribute("aria-current",!0)):(t.classList.remove("active"),t.setAttribute("aria-current",!1))})}},{key:"setSlideBlock",value:function(){this.$el.btnPrev.classList.remove("btn-disabled"),this.$el.btnNext.classList.remove("btn-disabled"),this.isBlockPrev=this.isBlockNext=!1,1==this.slideNow&&(this.$el.btnPrev.classList.add("btn-disabled"),this.isBlockPrev=!0),this.slideNow>this.slideNum-this.option.show&&(this.$el.btnNext.classList.add("btn-disabled"),this.isBlockNext=!0)}},{key:"setTimer",value:function(){this.option.timer?(this.playTimer(),this.$el.btnTimer.classList.add("active"),this.$el.btnTimer.setAttribute("aria-pressed",!1)):(this.stopTimer(),this.$el.btnTimer.classList.remove("active"),this.$el.btnTimer.setAttribute("aria-pressed",!0))}},{key:"playTimer",value:function(){var t=this;this.direction="next",this.timer=setTimeout(function(){t.showSlide(t.slideNext)},this.option.timerSpeed)}},{key:"stopTimer",value:function(){clearTimeout(this.timer)}},{key:"setAccessibility",value:function(){var i=this;[].concat(_toConsumableArray(this.$el.slideItemDub)).forEach(function(t,e){e>=i.slideActive&&e<i.slideActive+i.option.show?t.setAttribute("aria-hidden",!1):t.setAttribute("aria-hidden",!0)})}},{key:"resize",value:function(){var t=this;clearTimeout(this.timerResize),this.timerResize=setTimeout(function(){t.direction=null,t.setSlide(),t.showSlide(t.slideNow)},66)}},{key:"mouseDown",value:function(t){if(!this.option.drag||this.isAnimating)return!1;this.direction=null,this.start=getMousePos(t),this.clicked=!0}},{key:"mouseMove",value:function(t){if(!this.clicked)return!1;if(this.move=getMousePos(t),this.deltaY=this.move.y-this.start.y,this.move.x<this.rectSlide.x||this.move.x>this.rectSlide.width+this.rectSlide.x)return this.deltaX=0,!1;if(this.deltaX=this.move.x-this.start.x,5<Math.abs(this.deltaX)&&Math.abs(this.deltaY)<5)t.preventDefault();else if(Math.abs(this.deltaX)<5&&5<Math.abs(this.deltaY))return this.deltaX=0,!1;if(!this.option.reactDrag)return!1;this.drag=this.deltaX,(this.isBlockPrev&&0<this.deltaX||this.isBlockNext&&this.deltaX<0)&&(this.deltaX=this.drag=this.deltaX/5),this.$el.slide.style.transform="translate3d("+(-(this.itemWidth+this.option.between)*(this.slideNow-1)+this.drag)+"px, 0, 0)"}},{key:"mouseUp",value:function(){var e=this;if(!this.clicked)return!1;this.deltaX<=30&&-30<=this.deltaX?this.showSlide(this.slideNow):this.deltaX<30?(this.direction="next",this.showSlide(this.slideNext)):30<this.deltaX&&(this.direction="prev",this.showSlide(this.slidePrev)),this.deltaX=this.drag=0,this.clicked=!1,["mousemove","touchmove"].forEach(function(t){document.removeEventListener(t,e.mouseMove)}),["mouseup","touchend"].forEach(function(t){document.removeEventListener(t,e.mouseUp)})}},{key:"keyDown",value:function(s){var n=this;this.option.timer=!1,this.setTimer(),[].concat(_toConsumableArray(this.$etc.focusItem)).forEach(function(t,e,i){t.includes(s.target)&&(n.slideFocus=i.indexOf(t))}),"Tab"!=s.key||s.shiftKey?"Tab"==s.key&&s.shiftKey?this.eventKeyBackTab(s):37===s.keyCode?(this.direction,this.showSlide(this.slidePrev)):39===s.keyCode&&(this.direction,this.showSlide(this.slideNext)):this.eventKeyTab(s)}},{key:"eventKeyTab",value:function(t){switch(this.isFocusing=!0,t.target){case this.$etc.before:t.preventDefault(),triggerFocus(this.isBlockPrev?this.$etc.focusItem[this.slideActive][0]:this.$el.btnPrev);break;case this.$el.btnPrev:t.preventDefault(),triggerFocus(this.$etc.focusItem[this.slideActive][0]);break;case this.$etc.focusItem[this.slideActive][this.$etc.focusItem[this.slideActive].length-1]:t.preventDefault(),triggerFocus(this.isBlockNext?this.$el.indicatorItem[0].firstChild:this.$el.btnNext);break;case this.$el.btnTimer:this.isFocusing=!1}}},{key:"eventKeyBackTab",value:function(t){switch(this.isFocusing=!0,t.target){case this.$etc.after:this.isFocusing=!1;break;case this.$el.btnNext:t.preventDefault(),triggerFocus(this.$etc.focusItem[this.slideActive][this.$etc.focusItem[this.slideActive].length-1]);break;case this.$el.btnPrev:t.preventDefault(),this.isFocusing=!1,triggerFocus(this.$etc.before);break;case this.$etc.focusItem[this.slideActive][0]:case this.$etc.focusItem[0][0]:t.preventDefault(),triggerFocus(this.isBlockPrev?this.$etc.before:this.$el.btnPrev);break;case this.$el.indicatorItem[0].firstChild:t.preventDefault(),triggerFocus(this.isBlockNext?this.$etc.focusItem[this.slideActive][this.$etc.focusItem[this.slideActive].length-1]:this.$el.btnNext)}}}]),i}();